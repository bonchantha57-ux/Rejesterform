<!DOCTYPE html>
<html lang="km">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ទម្រង់ចុះឈ្មោះព្រឹត្តិការណ៍ពិសេស</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.css"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kantumruy+Pro:wght@400;500;700&display=swap');
        :root{--primary-glow:#00ffff;--secondary-glow:#ff00ff;--background-dark:#0f101c;--text-color:#e0e0e0;--input-bg:rgba(0,0,0,.2)}
        *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
        body{font-family:'Kantumruy Pro',sans-serif;background-color:var(--background-dark);background-image:radial-gradient(rgba(255,255,255,.1) 1px,transparent 0);background-size:30px 30px;color:var(--text-color);display:flex;justify-content:center;align-items:center;min-height:100vh;padding:20px}
        .form-container{background:rgba(12,12,34,.5);border-top:2px solid var(--primary-glow);border-bottom:2px solid var(--secondary-glow);border-left:1px solid rgba(255,255,255,.1);border-right:1px solid rgba(255,255,255,.1);border-radius:15px;padding:2.5rem;width:100%;max-width:450px;text-align:center;animation:fade-in 1s ease-out forwards}
        @keyframes fade-in{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}
        h1{font-size:1.5rem;font-weight:700;margin-bottom:.5rem;color:#fff}
        p.subtitle{font-size:.9rem;margin-bottom:2.5rem;color:var(--text-color)}
        .input-group{margin-bottom:1.5rem;text-align:left}
        label{display:block;margin-bottom:.5rem;font-size:.9rem;font-weight:500}
        .name-group{display:flex;gap:1rem}
        .name-group .input-wrapper{flex:1}
        input[type=text],input[type=email],input[type=tel]{width:100%;background:var(--input-bg);border:2px solid;border-color:var(--primary-glow) var(--secondary-glow) var(--secondary-glow) var(--primary-glow);border-radius:8px;padding:12px 20px;color:var(--text-color);font-size:1rem;transition:all .3s ease}
        input:focus{outline:0;box-shadow:0 0 15px var(--primary-glow);background:rgba(0,255,255,.05)}
        .radio-group{display:flex;gap:2rem;margin-top:.7rem}
        .radio-group label{display:flex;align-items:center;cursor:pointer;color:var(--text-color)}
        .radio-group input[type=radio]{display:none}
        .radio-group label .custom-radio{width:20px;height:20px;border:2px solid var(--primary-glow);border-radius:50%;margin-right:10px;display:grid;place-items:center;transition:all .2s ease}
        .radio-group label .custom-radio::before{content:'';width:10px;height:10px;background-color:var(--secondary-glow);border-radius:50%;transform:scale(0);transition:transform .2s ease}
        .radio-group input[type=radio]:checked+label .custom-radio{border-color:var(--secondary-glow)}
        .radio-group input[type=radio]:checked+label .custom-radio::before{transform:scale(1)}
        .scan-section{display:none}
        .qr-image-container{text-align:center;margin:1.5rem 0}
        .qr-image-container img{max-width:150px;height:auto;border-radius:8px}
        #submit-btn{font-family:'Kantumruy Pro',sans-serif;padding:12px 30px;border:none;border-radius:50px;font-size:1rem;font-weight:700;color:#fff;cursor:pointer;background:linear-gradient(90deg,var(--secondary-glow),var(--primary-glow));transition:all .3s ease;box-shadow:0 0 15px rgba(255,0,255,.4),0 0 15px rgba(0,255,255,.4);letter-spacing:1px}
        #submit-btn:hover{transform:translateY(-2px);box-shadow:0 0 25px rgba(255,0,255,.6),0 0 25px rgba(0,255,255,.6)}
        .footer-text{margin-top:2.5rem;font-size:.8rem;opacity:.7}
        #submit-btn{margin-top:2rem;width:100%}
        #loading,#success-message{display:none;margin-top:1rem;font-weight:500}
        #success-message{color:#0f0}
        #loading{color:var(--primary-glow)}

        /* --- CSS ADDED: Styling for the intl-tel-input to match the theme --- */
        .iti {
            width: 100%;
        }
        .iti .iti__country-list {
            background-color: var(--background-dark);
            border-color: var(--primary-glow);
        }
        .iti .iti__country:hover {
            background-color: var(--input-bg);
        }
        .iti .iti__divider {
            border-color: rgba(255, 255, 255, 0.1);
        }
        /* --- END OF ADDED CSS --- */
    </style>
</head>
<body>
    <div class="form-container">
        <h1>ទម្រង់ចុះឈ្មោះហាត់ការងារជាក្រុមបំប៉នពិសេស</h1>
        <p class="subtitle">ចំណេះដឹងគ្មានដែនកំណត់!</p>
        <form id="registration-form">
            <div class="name-group">
                <div class="input-wrapper"><label for="surname">គោត្តនាម</label><input type="text" id="surname" name="Surname" required></div>
                <div class="input-wrapper"><label for="name">នាម</label><input type="text" id="name" name="Name" required></div>
            </div>
            <div class="input-group"><label for="email">Gmail</label><input type="email" id="email" name="Email" required></div>
            
            <div class="input-group">
                <label for="phone">លេខទូរស័ព្ទ</label>
                <input type="tel" id="phone" name="Phone" required>
            </div>
            
            <div class="input-group"><label for="gender">ភេទ</label><div class="radio-group"><div><input type="radio" id="male" name="Gender" value="ប្រុស" required><label for="male"><span class="custom-radio"></span>ប្រុស</label></div><div><input type="radio" id="female" name="Gender" value="ស្រី"><label for="female"><span class="custom-radio"></span>ស្រី</label></div></div></div>
            <div class="input-group"><label for="location">ជំនាញសិក្សារ</label><input type="text" id="location" name="Location" required></div>
            <div class="qr-image-container"><img src="./QR.png" alt="QR Code for Event"></div>
            <p>ស្កេនដើម្បីទាក់ទងអ្នកគ្រប់គ្រង</p>
            <div class="scan-section"><input type="file" id="image-upload" name="Image" accept="image/*" style="display:none"><div id="image-preview"></div><p style="font-size:.8em;opacity:.7">ស្កេន ដើម្បីផ្ទៀងផ្ទាត់</p></div>
            <button type="submit" id="submit-btn">ចុះឈ្មោះ</button>
            <p id="loading">កំពុងដំណើរការ...</p>
            <p id="success-message">ការចុះឈ្មោះបានជោគជ័យ!</p>
        </form>
        <div class="footer-text"><span>អភិវឌ្ឍន៍ដោយ BORN CHANTHA</span></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('registration-form');
            const loadingMessage = document.getElementById('loading');
            const successMessage = document.getElementById('success-message');
            const submitBtn = document.getElementById('submit-btn');
            
            const scriptURL = 'https://script.google.com/macros/s/AKfycbwP4r5-gaxcx9rpU1sSiLCsryw9Ep9AQsMbWIq50oMJTMVl7hDdW5FO1N0byUy-S9Cn/exec'; 
            const fixedImageURL = './QR.png';

            // --- JAVASCRIPT MODIFICATION: Initialize intl-tel-input ---
            const phoneInputField = document.querySelector("#phone");
            const phoneInput = window.intlTelInput(phoneInputField, {
                initialCountry: "kh", // Set default country to Cambodia
                utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",
            });
            // --- END OF INITIALIZATION ---

            form.addEventListener('submit', e => {
                e.preventDefault();
                loadingMessage.style.display = 'block';
                successMessage.style.display = 'none';
                submitBtn.disabled = true;

                const formData = new FormData(form);
                
                // --- JAVASCRIPT MODIFICATION: Get the full international number ---
                const fullPhoneNumber = phoneInput.getNumber();
                formData.set('Phone', fullPhoneNumber); // Set the 'Phone' field to the full number
                // --- END OF MODIFICATION ---
                
                formData.append('ImageName', fixedImageURL);

                fetch(scriptURL, { method: 'POST', body: formData })
                    .then(response => {
                        console.log('Success!', response);
                        loadingMessage.style.display = 'none';
                        successMessage.style.display = 'block';
                        submitBtn.disabled = false;
                        form.reset();
                        // Reset phone input to default country
                        phoneInput.setCountry("kh");
                        setTimeout(() => successMessage.style.display = 'none', 5000);
                    })
                    .catch(error => {
                        console.error('Error!', error.message);
                        loadingMessage.style.display = 'none';
                        alert('មានបញ្ហាក្នុងការចុះឈ្មោះ សូមព្យាយាមម្តងទៀត។');
                        submitBtn.disabled = false;
                    });
            });
        });
    </script>
</body>
</html>
